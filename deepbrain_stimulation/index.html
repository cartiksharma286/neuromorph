<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBS-PTSD Treatment System</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Warning Banner -->
    <div class="warning-banner">
        <div class="warning-content">
            <span class="warning-icon">‚ö†</span>
            <span>RESEARCH & EDUCATIONAL USE ONLY - Not for clinical application</span>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="title">
                    <span class="title-icon">üß†</span>
                    Deep Brain Stimulation for PTSD Treatment
                </h1>
                <p class="subtitle">AI-Powered Circuit Design & Parameter Optimization</p>
            </div>
            <div class="status-indicator">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Initializing...</span>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-module="circuit">
                <span class="tab-icon">‚ö°</span>
                Circuit Designer
            </button>
            <button class="nav-tab" data-module="brain">
                <span class="tab-icon">üß†</span>
                3D Brain Model
            </button>
            <button class="nav-tab" data-module="waveform">
                <span class="tab-icon">üìä</span>
                Waveform Generator
            </button>
            <button class="nav-tab" data-module="ai">
                <span class="tab-icon">ü§ñ</span>
                AI Optimizer
            </button>
            <button class="nav-tab" data-module="clinical">
                <span class="tab-icon">üìà</span>
                Clinical Dashboard
            </button>
            <button class="nav-tab" data-module="fea">
                <span class="tab-icon">‚ö°</span>
                FEA Simulation
            </button>
            <button class="nav-tab" data-module="protocol">
                <span class="tab-icon">üìã</span>
                Treatment Protocols
            </button>
            <button class="nav-tab" data-module="ocd">
                <span class="tab-icon">üîÑ</span>
                OCD Treatment
            </button>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Circuit Designer Module -->
            <div class="module active" id="circuitModule">
                <div class="module-header">
                    <h2>DBS Circuit Schematic Designer</h2>
                    <p>Professional-grade circuit schematics for deep brain stimulation devices</p>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h3>Circuit Components</h3>
                        <div class="component-list">
                            <button class="component-btn" data-component="electrode-array">
                                <span class="component-icon">üîå</span>
                                <div>
                                    <div class="component-name">Electrode Array</div>
                                    <div class="component-desc">Multi-contact lead system</div>
                                </div>
                            </button>
                            <button class="component-btn" data-component="pulse-generator">
                                <span class="component-icon">‚ö°</span>
                                <div>
                                    <div class="component-name">Pulse Generator</div>
                                    <div class="component-desc">Programmable current source</div>
                                </div>
                            </button>
                            <button class="component-btn" data-component="power-management">
                                <span class="component-icon">üîã</span>
                                <div>
                                    <div class="component-name">Power Management</div>
                                    <div class="component-desc">Battery & wireless charging</div>
                                </div>
                            </button>
                            <button class="component-btn" data-component="safety-system">
                                <span class="component-icon">üõ°Ô∏è</span>
                                <div>
                                    <div class="component-name">Safety System</div>
                                    <div class="component-desc">Monitoring & protection</div>
                                </div>
                            </button>
                            <button class="component-btn" data-component="signal-processing">
                                <span class="component-icon">üì°</span>
                                <div>
                                    <div class="component-name">Signal Processing</div>
                                    <div class="component-desc">LFP recording & feedback</div>
                                </div>
                            </button>
                            <button class="component-btn" data-component="complete">
                                <span class="component-icon">üîß</span>
                                <div>
                                    <div class="component-name">Complete System</div>
                                    <div class="component-desc">Full device schematic</div>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Circuit Schematic</h3>
                        <div id="circuitDisplay" class="circuit-display">
                            <div class="empty-state">
                                <span class="empty-icon">‚ö°</span>
                                <p>Select a component to view schematic</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>SVG Circuit Diagram</h3>
                    <div id="svgDisplay" class="svg-display"></div>
                </div>
            </div>

            <!-- 3D Brain Model Module -->
            <div class="module" id="brainModule">
                <div class="module-header">
                    <h2>3D Brain Visualization</h2>
                    <p>Interactive brain model with target regions for DBS</p>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h3>Target Regions</h3>
                        <div class="region-list" id="regionList"></div>
                    </div>

                    <div class="card full-height">
                        <h3>3D Brain Model</h3>
                        <div id="brainCanvas" class="brain-canvas"></div>
                    </div>
                </div>
            </div>

            <!-- Waveform Generator Module -->
            <div class="module" id="waveformModule">
                <div class="module-header">
                    <h2>Stimulation Waveform Generator</h2>
                    <p>Design and optimize DBS stimulation parameters</p>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h3>Parameters</h3>
                        <div class="parameter-controls" id="parameterControls"></div>

                        <div class="safety-status" id="safetyStatus"></div>

                        <button class="btn-primary" id="simulateBtn">
                            <span>‚ñ∂</span> Simulate Stimulation
                        </button>
                    </div>

                    <div class="card">
                        <h3>Waveform Preview</h3>
                        <canvas id="waveformCanvas" class="waveform-canvas"></canvas>

                        <h3 style="margin-top: 2rem;">Safety Metrics</h3>
                        <div id="safetyMetrics" class="metrics-grid"></div>
                    </div>
                </div>
            </div>

            <!-- AI Optimizer Module -->
            <div class="module" id="aiModule">
                <div class="module-header">
                    <h2>Gemini 3.0 AI-Driven Parameter Optimization</h2>
                    <p>Generative AI models with Proprioceptive Feedback and FEA Integration</p>
                </div>

                <div class="grid-3">
                    <div class="card">
                        <h3>VAE Generator</h3>
                        <p class="card-desc">Variational Autoencoder for pattern learning</p>
                        <button class="btn-secondary" id="trainVAEBtn">Train VAE</button>
                        <button class="btn-primary" id="generateVAEBtn">Generate Parameters</button>
                        <div id="vaeResults" class="results-container"></div>
                    </div>

                    <div class="card">
                        <h3>GAN Optimizer</h3>
                        <p class="card-desc">Generative Adversarial Network for waveform optimization</p>
                        <button class="btn-secondary" id="trainGANBtn">Train GAN</button>
                        <button class="btn-primary" id="generateGANBtn">Generate Parameters</button>
                        <div id="ganResults" class="results-container"></div>
                    </div>

                    <div class="card">
                        <h3>Gemini 3.0 RL Agent</h3>
                        <p class="card-desc">Reinforcement Learning with Proprioceptive Feedback</p>
                        <button class="btn-primary" id="optimizeRLBtn">Optimize with Gemini 3.0</button>
                        <div id="rlResults" class="results-container"></div>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h3>Training Progress</h3>
                        <canvas id="trainingCanvas" class="training-canvas"></canvas>
                    </div>
                    <div class="card">
                        <h3>Proprioceptive Feedback Loop</h3>
                        <p class="card-desc">Real-time system state stability and gradient sensation</p>
                        <canvas id="proprioceptionCanvas" class="training-canvas"
                            style="border-color: var(--secondary);"></canvas>
                        <div id="feaIntegrationStatus"
                            style="margin-top:10px; font-size:0.9em; color:var(--text-secondary);">
                            Linked to FEA Simulator: <span style="color:var(--secondary);">Active</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Clinical Dashboard Module -->
            <div class="module" id="clinicalModule">
                <div class="module-header">
                    <h2>Clinical Monitoring Dashboard</h2>
                    <p>PTSD symptom tracking and treatment efficacy</p>
                </div>

                <div class="grid-4">
                    <div class="metric-card">
                        <div class="metric-label">Hyperarousal</div>
                        <div class="metric-value" id="metricHyperarousal">--</div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="barHyperarousal"></div>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Re-experiencing</div>
                        <div class="metric-value" id="metricReexperiencing">--</div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="barReexperiencing"></div>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Avoidance</div>
                        <div class="metric-value" id="metricAvoidance">--</div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="barAvoidance"></div>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Negative Cognition</div>
                        <div class="metric-value" id="metricNegativeCognition">--</div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="barNegativeCognition"></div>
                        </div>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h3>Treatment Prediction</h3>
                        <div class="prediction-controls">
                            <label>Treatment Duration (weeks)</label>
                            <input type="number" id="treatmentWeeks" value="12" min="1" max="52">
                            <button class="btn-primary" id="predictBtn">Predict Response</button>
                        </div>
                        <canvas id="predictionCanvas" class="prediction-canvas"></canvas>
                    </div>

                    <div class="card">
                        <h3>Biomarkers</h3>
                        <div id="biomarkers" class="biomarkers-grid"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>Neural Activity</h3>
                    <canvas id="neuralCanvas" class="neural-canvas"></canvas>
                </div>
            </div>
            <!-- FEA Simulation Module -->
            <div class="module" id="feaModule">
                <div class="module-header">
                    <h2>Finite Element Analysis (FEA)</h2>
                    <p>Simulate electric field distribution and volume of tissue activated (VTA)</p>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h3>Simulation Controls</h3>
                        <div class="control-group">
                            <label>Target Coordinates (X, Y)</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="number" id="targetX" value="32" min="0" max="63">
                                <input type="number" id="targetY" value="32" min="0" max="63">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Active Contact Voltage (V)</label>
                            <input type="number" id="voltageC1" value="-3.0" step="0.1">
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn-primary" id="runFeaBtn">Run Simulation</button>
                            <button class="btn-secondary" id="optimizeFeaBtn">Auto-Optimize Platform</button>
                        </div>
                        <div id="feaStats" style="margin-top: 20px; font-family: monospace;"></div>
                    </div>

                    <div class="card">
                        <h3>Field Visualizations</h3>
                        <div class="grid-2" style="gap: 10px;">
                            <div>
                                <img id="imgPotential" style="width:100%; border-radius: 8px; border: 1px solid #333;"
                                    alt="Potential">
                                <div style="text-align:center; font-size: 0.8em; color: #888;">Potential Map</div>
                            </div>
                            <div>
                                <img id="imgEField" style="width:100%; border-radius: 8px; border: 1px solid #333;"
                                    alt="E-Field">
                                <div style="text-align:center; font-size: 0.8em; color: #888;">E-Field Magnitude</div>
                            </div>
                            <div>
                                <img id="imgVTA" style="width:100%; border-radius: 8px; border: 1px solid #333;"
                                    alt="VTA">
                                <div style="text-align:center; font-size: 0.8em; color: #888;">VTA Mask</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Protocol Module -->
            <div class="module" id="protocolModule">
                <div class="module-header">
                    <h2>Multi-Stage Treatment Paradigm Optimizer</h2>
                    <p>Design and simulate sequential treatment protocols for targeted zones</p>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h3>Protocol Configuration</h3>
                        <div class="control-group">
                            <label>Target Zones (Hold Ctrl to select multiple)</label>
                            <select id="protocolTargets" multiple
                                style="width: 100%; height: 100px; background: #1c1c1e; color: white; border: 1px solid #333; padding: 5px;">
                                <option value="amygdala" selected>Amygdala (Fear)</option>
                                <option value="hippocampus">Hippocampus (Memory)</option>
                                <option value="vmPFC">vmPFC (Regulation)</option>
                                <option value="hypothalamus">Hypothalamus (Stress)</option>
                                <option value="nucleus_basalis">Nucleus Basalis (Dementia)</option>
                                <option value="fornix">Fornix (Alzheimer's)</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Total Duration (Weeks)</label>
                            <input type="number" id="protocolDuration" value="12" min="4" max="52">
                        </div>
                        <button class="btn-primary" id="optimizeProtocolBtn" style="margin-top: 20px;">Generate
                            Optimized Protocol</button>
                    </div>

                    <div class="card">
                        <h3>Generated Sequence</h3>
                        <div id="protocolTimeline" style="height: 300px; overflow-y: auto; font-size: 0.9em;">
                            <div class="empty-state">No protocol generated yet.</div>
                        </div>
                        <div class="metric-value" id="protocolProjection"
                            style="margin-top: 10px; font-size: 1.2em; color: #4cd964;"></div>
                        <div class="card" style="margin-top: 20px;">
                            <h3>Gemini 3.0 Optimal Treatment Paradigm</h3>
                            <div id="geminiParadigmDisplay"
                                style="padding: 15px; background: rgba(0, 212, 255, 0.05); border-radius: 8px; border: 1px solid var(--border-color);">

                                <div
                                    style="display:flex; align-items:center; justify-content: space-between; margin-bottom:15px;">
                                    <div style="display:flex; align-items:center; gap:10px;">
                                        <span style="font-size:1.5em;">‚ú®</span>
                                        <strong style="color:var(--primary); font-size: 1.2em;">Gemini 3.0 Multimodal
                                            Reasoning Engine</strong>
                                    </div>
                                    <span class="status-badge"
                                        style="background:#32d74b33; color:#32d74b; padding:4px 8px; border-radius:4px; font-size:0.8em;">OPTIMIZED</span>
                                </div>

                                <div class="grid-2">
                                    <!-- BEM Visualization -->
                                    <div style="background:var(--bg-dark); padding:10px; border-radius:8px;">
                                        <div
                                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                                            <h4 style="color:#aaa; font-size:0.9em; margin:0;">BEM Cortical Surface
                                                Simulation</h4>
                                            <button id="generateBemBtn"
                                                style="background:var(--bg-elevated); border:1px solid var(--border-color); color:var(--text-secondary); padding:2px 8px; border-radius:4px; font-size:0.8em; cursor:pointer;"
                                                title="Regenerate BEM Model">‚Üª Sim</button>
                                        </div>
                                        <canvas id="corticalCanvas" width="400" height="300"></canvas>
                                        <div
                                            style="display:flex; justify-content:space-between; margin-top:5px; font-size:0.8em; color:#fff;">
                                            <span>Max E-Field: <span id="bemFieldVal"
                                                    style="color:var(--secondary)">--</span> V/m</span>
                                            <span>VTA Intersection: <span id="bemInterVal"
                                                    style="color:var(--warning)">--</span>%</span>
                                        </div>
                                    </div>

                                    <!-- Reasoning Logs & Connectome -->
                                    <div style="display:flex; flex-direction:column; gap:10px;">
                                        <div style="background:var(--bg-elevated); padding:10px; border-radius:8px;">
                                            <h4 style="color:#aaa; font-size:0.9em; margin-bottom:5px;">Connectome
                                                Constraints</h4>
                                            <div class="metrics-grid" style="grid-template-columns: 1fr 1fr;">
                                                <div>
                                                    <div style="font-size:0.8em; color:#888;">Pathway Integrity</div>
                                                    <div id="connIntegrity" style="font-size:1.2em; color:#fff;">--
                                                    </div>
                                                </div>
                                                <div>
                                                    <div style="font-size:0.8em; color:#888;">Struct. Conn.</div>
                                                    <div id="connStruct" style="font-size:1.2em; color:#fff;">--</div>
                                                </div>
                                            </div>
                                        </div>

                                        <div
                                            style="flex-grow:1; background:var(--bg-dark); padding:10px; border-radius:8px; border-left: 2px solid var(--primary);">
                                            <h4 style="color:#aaa; font-size:0.9em; margin-bottom:5px;">Reasoning Trace
                                            </h4>
                                            <div id="reasoningLogs"
                                                style="font-family:monospace; font-size:0.8em; color:#ccc; height:150px; overflow-y:auto;">
                                                <span style="color:#555;">> Awaiting optimization...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
        </main>

        <!-- OCD Treatment Module -->
        <div class="module" id="ocdModule">
            <div class="module-header">
                <h2>OCD: Cyclic Reasoning & DBS Interventions</h2>
                <p>Target the OFC-Caudate-Thalamus loop to break critical obsessiveness cycles</p>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h3>DBS Parameters for OCD</h3>
                    <div class="control-group">
                        <label>Target Region</label>
                        <select id="ocdTarget"
                            style="width: 100%; padding: 8px; background: #333; color: white; border: 1px solid #555;">
                            <option value="caudate" selected>Caudate Nucleus (Gating)</option>
                            <option value="stn">Subthalamic Nucleus (STN)</option>
                            <option value="vc_vs">Ventral Capsule / Ventral Striatum</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Frequency (Hz)</label>
                        <input type="number" id="ocdFreq" value="130" min="2" max="250">
                    </div>
                    <div class="control-group">
                        <label>Amplitude (mA)</label>
                        <input type="number" id="ocdAmp" value="3.0" step="0.1" min="0">
                    </div>

                    <div style="margin-top: 20px;">
                        <button class="btn-secondary" id="runSingleOcdBtn">Run Single Simulation</button>
                    </div>

                    <div id="singleResult"
                        style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">
                        <div style="font-size: 0.9em; color: #aaa;">Current State</div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Loop Gain: <b id="valGain" style="color: var(--secondary)">--</b></span>
                            <span>YBOCS: <b id="valYbocs" style="color: var(--warning)">--</b></span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Statistical Clinical Trial Design</h3>
                    <div class="control-group">
                        <label>Sample Size (N)</label>
                        <input type="number" id="trialN" value="50" min="10" max="500">
                    </div>
                    <div class="control-group">
                        <label>Significance Threshold (alpha)</label>
                        <input type="number" id="trialAlpha" value="0.05" step="0.01">
                    </div>

                    <button class="btn-primary" id="runTrialBtn" style="width: 100%; margin-top: 10px;">
                        <span>üìä</span> Run Statistical Trial
                    </button>

                    <div id="trialResults" style="margin-top: 15px; display: none;">
                        <h4 style="margin-bottom: 5px;">Trial Outcome</h4>
                        <div class="metrics-grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="metric-card" style="padding: 10px;">
                                <div class="metric-label">Mean YBOCS Red.</div>
                                <div class="metric-value" id="resRed" style="font-size: 1.2em;">--%</div>
                            </div>
                            <div class="metric-card" style="padding: 10px;">
                                <div class="metric-label">P-Value</div>
                                <div class="metric-value" id="resP" style="font-size: 1.2em;">--</div>
                            </div>
                        </div>
                        <div id="resSig" style="text-align: center; margin-top: 10px; font-weight: bold;"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Population Distribution (Pre vs Post)</h3>
                <canvas id="ocdTrialCanvas" style="width: 100%; height: 300px;"></canvas>
            </div>

            <!-- OCD Schematic Section -->
            <div class="card" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>OCD Treatment Circuit Schematic & Specs</h3>
                    <button id="loadOcdSchematicBtn" class="btn-secondary" style="font-size: 0.8em;">Show
                        Schematic</button>
                </div>

                <div id="ocdSchematicContent" style="display: none; margin-top: 15px;">
                    <div class="grid-2">
                        <div style="background: #111; padding: 15px; border-radius: 8px; border: 1px solid #333;">
                            <h4>Electrical Specifications</h4>
                            <div id="ocdSpecsList"
                                style="font-family: monospace; font-size: 0.9em; line-height: 1.6; color: #ccc;">
                                <!-- Specs injected here -->
                            </div>
                        </div>
                        <div id="ocdSvgContainer"
                            style="background: #000; border: 1px solid #333; border-radius: 8px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                            <!-- SVG injected here -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- Quantum Optimization Section -->
            <div class="card" style="margin-top:20px;">
                <h3>Quantum Surface Integral Optimization</h3>
                <p style="font-size:0.9em; color:#aaa;">Correlate FEA E-Field distribution with OCD Attractor Energy
                    States.</p>
                <button id="runQuantumFeaBtn" class="btn-primary" style="margin-top:10px;">
                    <span>‚öõÔ∏è</span> Optimize Quantum-FEA Protocol
                </button>
                <div id="quantumFeaResults" style="display:none;"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="app.js"></script>
    <script src="circuit_designer.js"></script>
    <script src="brain_visualizer.js"></script>
    <script src="waveform_generator.js"></script>
    <script src="ai_optimizer.js"></script>
    <script src="clinical_dashboard.js"></script>
    <script src="fea_interface.js"></script>
    <script src="protocol_interface.js"></script>
    <script src="ocd_dashboard.js"></script>
</body>

</html>